<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>èµŒå¾’å‚¬ä¿ƒç³»ç»Ÿæµ‹è¯•</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #1a1a1a;
      color: #fff;
    }
    .test-container {
      max-width: 900px;
      margin: 0 auto;
    }
    .test-section {
      background: #2a2a2a;
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
      border: 1px solid #444;
    }
    button {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 12px 24px;
      margin: 5px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
    }
    button:hover {
      background: #45a049;
    }
    button.danger {
      background: #f44336;
    }
    button.danger:hover {
      background: #da190b;
    }
    button.warning {
      background: #ff9800;
    }
    button.warning:hover {
      background: #e68900;
    }
    .info {
      background: #333;
      padding: 15px;
      margin: 10px 0;
      border-radius: 4px;
      font-size: 14px;
      line-height: 1.6;
    }
    .status {
      background: #1e3a5f;
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
      border-left: 4px solid #2196F3;
    }
    h1 {
      color: #ffcc00;
      text-align: center;
    }
    h2 {
      color: #ffcc00;
      margin-top: 0;
    }
    h3 {
      color: #d4af37;
    }
    .timeline {
      background: #1a1a1a;
      padding: 15px;
      margin: 15px 0;
      border-radius: 4px;
      font-family: monospace;
      font-size: 13px;
      line-height: 1.8;
    }
    .timeline-item {
      padding: 5px 0;
    }
    .time {
      color: #4CAF50;
      font-weight: bold;
    }
    .event {
      color: #ffcc00;
    }
  </style>
</head>
<body>
  <div class="test-container">
    <h1>ğŸ° èµŒå¾’å‚¬ä¿ƒç³»ç»Ÿæµ‹è¯•</h1>
    
    <div class="test-section">
      <h2>ğŸ“‹ ç³»ç»Ÿè¯´æ˜</h2>
      <div class="info">
        <p><strong>æ–°çš„å¯¹è¯æµç¨‹ï¼š</strong></p>
        <div class="timeline">
          <div class="timeline-item">
            <span class="time">0s</span> - <span class="event">ç©å®¶è¿›å…¥ç•Œé¢</span> â†’ æ˜¾ç¤ºæ¬¢è¿è¯­ï¼ˆä»…é¦–æ¬¡ï¼‰
          </div>
          <div class="timeline-item">
            <span class="time">3s</span> - <span class="event">æ¬¢è¿è¯­æ¶ˆå¤±</span> â†’ å¼€å§‹å‚¬ä¿ƒç³»ç»Ÿ
          </div>
          <div class="timeline-item">
            <span class="time">3s</span> - <span class="event">ç¬¬ä¸€æ¡å‚¬ä¿ƒè¯­</span> â†’ æ˜¾ç¤ºéšæœºå‚¬ä¿ƒè¯­
          </div>
          <div class="timeline-item">
            <span class="time">7s</span> - <span class="event">ç¬¬äºŒæ¡å‚¬ä¿ƒè¯­</span> â†’ æ¯4ç§’æ›´æ–°
          </div>
          <div class="timeline-item">
            <span class="time">11s</span> - <span class="event">ç¬¬ä¸‰æ¡å‚¬ä¿ƒè¯­</span> â†’ æŒç»­å¾ªç¯...
          </div>
          <div class="timeline-item">
            <span class="time">---</span> - <span class="event">ç©å®¶å¼€å§‹æŠ½å¥–</span> â†’ åœæ­¢å‚¬ä¿ƒ
          </div>
          <div class="timeline-item">
            <span class="time">æŠ½å¥–å®Œæˆ</span> - <span class="event">æ˜¾ç¤ºè¯„åˆ¤è¯­</span> â†’ 3ç§’åé‡æ–°å¼€å§‹å‚¬ä¿ƒ
          </div>
        </div>
        <p><strong>âœ… æ¬¢è¿è¯­åªåœ¨é¦–æ¬¡è¿›å…¥æ—¶æ˜¾ç¤º</strong></p>
        <p><strong>âœ… å‚¬ä¿ƒè¯­æ¯4ç§’è‡ªåŠ¨æ›´æ–°ï¼Œç›´åˆ°ç©å®¶æ“ä½œ</strong></p>
        <p><strong>âœ… æŠ½å¥–å®Œæˆåæ˜¾ç¤ºè¯„åˆ¤è¯­ï¼Œç„¶åç»§ç»­å‚¬ä¿ƒ</strong></p>
      </div>
    </div>

    <div class="status" id="status">
      <strong>çŠ¶æ€ï¼š</strong> <span id="statusText">æœªåˆå§‹åŒ–</span>
    </div>

    <div class="test-section">
      <h2>1. åŸºç¡€æµ‹è¯•</h2>
      <button onclick="testWelcome()">ğŸª æ¨¡æ‹Ÿè¿›å…¥ç•Œé¢ï¼ˆé¦–æ¬¡ï¼‰</button>
      <button onclick="testWelcomeAgain()">ğŸ”„ æ¨¡æ‹Ÿå†æ¬¡è¿›å…¥ï¼ˆä¸æ˜¾ç¤ºæ¬¢è¿è¯­ï¼‰</button>
      <button onclick="stopUrge()" class="danger">â¹ï¸ åœæ­¢å‚¬ä¿ƒ</button>
      <button onclick="resetNPC()" class="warning">ğŸ”„ é‡ç½®NPC</button>
    </div>

    <div class="test-section">
      <h2>2. æŠ½å¥–æµç¨‹æµ‹è¯•</h2>
      <button onclick="simulateSpin('legendary')">â­ æ¨¡æ‹ŸæŠ½åˆ°ä¼ è¯´</button>
      <button onclick="simulateSpin('epic')">ğŸ’œ æ¨¡æ‹ŸæŠ½åˆ°å²è¯—</button>
      <button onclick="simulateSpin('rare')">ğŸ’™ æ¨¡æ‹ŸæŠ½åˆ°ç¨€æœ‰</button>
      <button onclick="simulateSpin('trash')">ğŸ—‘ï¸ æ¨¡æ‹ŸæŠ½åˆ°åƒåœ¾</button>
    </div>

    <div class="test-section">
      <h2>3. å®Œæ•´æµç¨‹æµ‹è¯•</h2>
      <button onclick="testFullFlow()">ğŸ¬ å®Œæ•´æµç¨‹æ¼”ç¤º</button>
      <div class="info">
        <p>å°†è‡ªåŠ¨æ‰§è¡Œï¼šè¿›å…¥ç•Œé¢ â†’ ç­‰å¾…å‚¬ä¿ƒ â†’ æŠ½å¥– â†’ æ˜¾ç¤ºè¯„åˆ¤ â†’ ç»§ç»­å‚¬ä¿ƒ</p>
      </div>
    </div>

    <div class="test-section">
      <h2>4. æ‰‹åŠ¨æ§åˆ¶</h2>
      <button onclick="manualUrge()">ğŸ’¬ æ‰‹åŠ¨æ˜¾ç¤ºä¸€æ¡å‚¬ä¿ƒè¯­</button>
      <button onclick="manualJudgement()">âš–ï¸ æ‰‹åŠ¨æ˜¾ç¤ºè¯„åˆ¤è¯­</button>
    </div>

    <div class="test-section">
      <h2>ğŸ“Š æ—¥å¿—</h2>
      <div class="info" id="log" style="max-height: 300px; overflow-y: auto; font-family: monospace; font-size: 12px;">
        ç­‰å¾…æµ‹è¯•...
      </div>
    </div>
  </div>

  <script type="module">
    import { GamblerNPC } from './src/ui/GamblerNPC.js';

    // åˆ›å»ºå…¨å±€ NPC å®ä¾‹
    window.npc = new GamblerNPC();
    
    // æ—¥å¿—ç³»ç»Ÿ
    const logElement = document.getElementById('log');
    const statusText = document.getElementById('statusText');
    
    function log(message, type = 'info') {
      const timestamp = new Date().toLocaleTimeString();
      const colors = {
        info: '#4CAF50',
        warn: '#ff9800',
        error: '#f44336',
        success: '#00bcd4'
      };
      const color = colors[type] || colors.info;
      logElement.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
      logElement.scrollTop = logElement.scrollHeight;
      console.log(`[${timestamp}] ${message}`);
    }

    function updateStatus(text, color = '#4CAF50') {
      statusText.textContent = text;
      statusText.style.color = color;
    }

    // æµ‹è¯•å‡½æ•°
    window.testWelcome = () => {
      log('ğŸª æ¨¡æ‹Ÿé¦–æ¬¡è¿›å…¥ç•Œé¢', 'success');
      window.npc.showWelcome();
      updateStatus('æ˜¾ç¤ºæ¬¢è¿è¯­ï¼Œ3ç§’åå¼€å§‹å‚¬ä¿ƒ', '#ffcc00');
    };

    window.testWelcomeAgain = () => {
      log('ğŸ”„ æ¨¡æ‹Ÿå†æ¬¡è¿›å…¥ç•Œé¢ï¼ˆå·²æ˜¾ç¤ºè¿‡æ¬¢è¿è¯­ï¼‰', 'info');
      window.npc.showWelcome();
      updateStatus('è·³è¿‡æ¬¢è¿è¯­ï¼Œç›´æ¥å¼€å§‹å‚¬ä¿ƒ', '#ff9800');
    };

    window.stopUrge = () => {
      log('â¹ï¸ åœæ­¢å‚¬ä¿ƒç³»ç»Ÿ', 'warn');
      window.npc.stopUrging();
      updateStatus('å‚¬ä¿ƒå·²åœæ­¢', '#f44336');
    };

    window.resetNPC = () => {
      log('ğŸ”„ é‡ç½®NPCï¼ˆæ¸…é™¤æ¬¢è¿è¯­æ ‡è®°ï¼‰', 'warn');
      window.npc.resetWelcome();
      window.npc.stopUrging();
      window.npc.hide();
      updateStatus('NPCå·²é‡ç½®', '#2196F3');
    };

    window.simulateSpin = (quality) => {
      log(`ğŸ° æ¨¡æ‹Ÿå¼€å§‹æŠ½å¥–ï¼ˆ${quality}ï¼‰`, 'info');
      window.npc.stopUrging();
      updateStatus('æŠ½å¥–ä¸­...', '#ffcc00');
      
      // æ¨¡æ‹ŸæŠ½å¥–å»¶è¿Ÿ
      setTimeout(() => {
        const context = {
          result: { quality: quality.toUpperCase(), type: quality === 'trash' ? 'trash' : 'item' },
          pityCount: 0,
          isNearMiss: false,
          playerGold: 1000
        };
        
        log(`âœ¨ æŠ½å¥–å®Œæˆï¼Œæ˜¾ç¤ºè¯„åˆ¤è¯­ï¼ˆ${quality}ï¼‰`, 'success');
        window.npc.showJudgement(context);
        updateStatus('æ˜¾ç¤ºè¯„åˆ¤è¯­ï¼Œ3ç§’åå¼€å§‹å‚¬ä¿ƒ', '#4CAF50');
      }, 1500);
    };

    window.testFullFlow = async () => {
      log('ğŸ¬ å¼€å§‹å®Œæ•´æµç¨‹æ¼”ç¤º', 'success');
      log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'info');
      
      // 1. è¿›å…¥ç•Œé¢
      log('1ï¸âƒ£ ç©å®¶è¿›å…¥ç•Œé¢', 'info');
      window.npc.resetWelcome();
      window.npc.showWelcome();
      updateStatus('æ­¥éª¤1: æ˜¾ç¤ºæ¬¢è¿è¯­', '#ffcc00');
      
      // 2. ç­‰å¾…å‚¬ä¿ƒå¼€å§‹
      await new Promise(resolve => setTimeout(resolve, 4000));
      log('2ï¸âƒ£ å‚¬ä¿ƒç³»ç»Ÿå·²å¯åŠ¨ï¼ˆåº”è¯¥çœ‹åˆ°å‚¬ä¿ƒè¯­ï¼‰', 'info');
      updateStatus('æ­¥éª¤2: å‚¬ä¿ƒä¸­...', '#ff9800');
      
      // 3. ç­‰å¾…å‡ æ¡å‚¬ä¿ƒè¯­
      await new Promise(resolve => setTimeout(resolve, 8000));
      log('3ï¸âƒ£ ç©å®¶å†³å®šæŠ½å¥–', 'info');
      
      // 4. æŠ½å¥–
      window.npc.stopUrging();
      updateStatus('æ­¥éª¤3: æŠ½å¥–ä¸­...', '#2196F3');
      await new Promise(resolve => setTimeout(resolve, 2000));
      
      // 5. æ˜¾ç¤ºç»“æœ
      const context = {
        result: { quality: 'EPIC', type: 'item' },
        pityCount: 0,
        isNearMiss: false,
        playerGold: 1000
      };
      log('4ï¸âƒ£ æŠ½å¥–å®Œæˆï¼Œæ˜¾ç¤ºè¯„åˆ¤è¯­', 'success');
      window.npc.showJudgement(context);
      updateStatus('æ­¥éª¤4: æ˜¾ç¤ºè¯„åˆ¤è¯­ï¼Œ3ç§’åç»§ç»­å‚¬ä¿ƒ', '#4CAF50');
      
      // 6. ç­‰å¾…å‚¬ä¿ƒé‡æ–°å¼€å§‹
      await new Promise(resolve => setTimeout(resolve, 4000));
      log('5ï¸âƒ£ å‚¬ä¿ƒç³»ç»Ÿé‡æ–°å¯åŠ¨ï¼ˆåº”è¯¥çœ‹åˆ°æ–°çš„å‚¬ä¿ƒè¯­ï¼‰', 'info');
      updateStatus('æ­¥éª¤5: ç»§ç»­å‚¬ä¿ƒä¸­...', '#ff9800');
      
      log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'info');
      log('âœ… å®Œæ•´æµç¨‹æ¼”ç¤ºå®Œæˆï¼', 'success');
    };

    window.manualUrge = () => {
      log('ğŸ’¬ æ‰‹åŠ¨æ˜¾ç¤ºå‚¬ä¿ƒè¯­', 'info');
      window.npc.showUrgeMessage();
      updateStatus('æ˜¾ç¤ºå‚¬ä¿ƒè¯­', '#ffcc00');
    };

    window.manualJudgement = () => {
      log('âš–ï¸ æ‰‹åŠ¨æ˜¾ç¤ºè¯„åˆ¤è¯­', 'info');
      const context = {
        result: { quality: 'RARE', type: 'item' },
        pityCount: 0,
        isNearMiss: false,
        playerGold: 1000
      };
      window.npc.showJudgement(context);
      updateStatus('æ˜¾ç¤ºè¯„åˆ¤è¯­ï¼Œ3ç§’åå¼€å§‹å‚¬ä¿ƒ', '#4CAF50');
    };

    // åˆå§‹åŒ–
    log('âœ… èµŒå¾’å‚¬ä¿ƒç³»ç»Ÿæµ‹è¯•é¡µé¢å·²åŠ è½½', 'success');
    log(`ğŸ“Š å‚¬ä¿ƒè¯­æ•°é‡: ${window.npc.dialogues.urge.length}`, 'info');
    log(`ğŸ“Š æ¬¢è¿è¯­æ•°é‡: ${window.npc.dialogues.welcome.length}`, 'info');
    updateStatus('å°±ç»ª', '#4CAF50');
  </script>
</body>
</html>
