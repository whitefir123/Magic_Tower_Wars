# 物品Tooltip完善修复

## 问题描述
赌徒界面中的某些奖品类型（Buff、灵魂水晶、金币等）缺少tooltip显示，鼠标悬停时无法查看物品详情。

## 问题分析

### 检查结果
1. ✅ **装备类物品**：所有T1-T3装备都有完整的`descZh`字段
2. ✅ **消耗品**：所有消耗品都有完整的`descZh`字段
3. ✅ **幸运石**：已在之前的修复中添加
4. ✅ **符文**：已在之前的修复中添加
5. ❌ **Buff**：有`desc`字段但TooltipManager未处理
6. ❌ **灵魂水晶**：TooltipManager未处理
7. ❌ **金币**：TooltipManager未处理

### 根本原因
TooltipManager的`generateTooltipContent`方法只处理了标准装备、消耗品、幸运石和符文，没有处理Buff、灵魂水晶和金币这三种特殊类型。

## 修复方案

### 新增Tooltip支持的物品类型

#### 1. Buff（临时增益）

**显示内容：**
- 名称：Buff名称（带品质颜色）
- 类型：临时增益
- 描述：Buff效果描述
- 标签：进攻/防御/物理/魔法/资源等

**示例：**
```
┌─────────────────────────────────┐
│ Buff: Might                     │
│ 临时增益                        │
│                                 │
│ 物攻提升                        │
│                                 │
│ 进攻 · 物理                     │
└─────────────────────────────────┘
```

#### 2. 灵魂水晶（货币）

**显示内容：**
- 名称：灵魂水晶数量（带品质颜色）
- 类型：货币
- 描述：用途说明
- 数量：具体数值（紫色高亮）

**示例：**
```
┌─────────────────────────────────┐
│ 5 灵魂水晶                      │
│ 货币                            │
│                                 │
│ 用于元进度系统的特殊货币，      │
│ 可以在死亡后保留并用于永久升级。│
│                                 │
│ 数量: 5                         │
└─────────────────────────────────┘
```

#### 3. 金币（货币）

**显示内容：**
- 名称：金币数量（带品质颜色）
- 类型：货币
- 描述：用途说明
- 数量：具体数值（金色高亮）

**示例：**
```
┌─────────────────────────────────┐
│ 50 金币                         │
│ 货币                            │
│                                 │
│ 游戏中的通用货币，可用于购买    │
│ 物品、强化装备等。              │
│                                 │
│ 数量: 50                        │
└─────────────────────────────────┘
```

## 技术实现

### 修改文件：src/utils/TooltipManager.js

在`generateTooltipContent`方法中添加三种新类型的处理：

```javascript
// Buff
if (itemOrId.type === 'buff' && itemOrId.data) {
  const buff = itemOrId.data;
  // 生成Buff tooltip
  // 显示：名称、类型、描述、标签
}

// 灵魂水晶
if (itemOrId.type === 'soul_crystal') {
  // 生成灵魂水晶tooltip
  // 显示：名称、类型、描述、数量
}

// 金币
if (itemOrId.type === 'gold') {
  // 生成金币tooltip
  // 显示：名称、类型、描述、数量
}
```

### Buff标签映射

```javascript
const tagNames = {
  'OFFENSE': '进攻',
  'DEFENSE': '防御',
  'PHYS': '物理',
  'MAG': '魔法',
  'RESOURCE': '资源'
};
```

### 颜色配置

- **灵魂水晶数量**：紫色 (#bb00ff)
- **金币数量**：金色 (#ffd700)
- **Buff标签**：灰色 (#888)

## 完整的物品类型支持列表

现在TooltipManager支持以下所有物品类型：

1. ✅ **装备** (WEAPON, ARMOR, HELM, BOOTS, RING, AMULET)
   - 显示：名称、类型、品质、强化等级、属性、词缀、套装信息等

2. ✅ **消耗品** (CONSUMABLE)
   - 显示：名称、类型、描述、效果

3. ✅ **幸运石** (trash类型，名称包含"幸运石")
   - 显示：名称、类型、描述、强化成功率加成

4. ✅ **符文** (rune类型)
   - 显示：名称、类型、符文类型、描述

5. ✅ **Buff** (buff类型) - **新增**
   - 显示：名称、类型、描述、标签

6. ✅ **灵魂水晶** (soul_crystal类型) - **新增**
   - 显示：名称、类型、描述、数量

7. ✅ **金币** (gold类型) - **新增**
   - 显示：名称、类型、描述、数量

8. ✅ **技能** (SKILL类型)
   - 显示：名称、类型、冷却时间、描述

## 测试验证

### 测试页面
```bash
# 在浏览器中打开
test_gambler_tooltip.html
```

### 测试内容
1. ✅ 所有品质的幸运石显示完整tooltip
2. ✅ 不同品质的符文显示对应tooltip
3. ✅ Buff显示名称、描述和标签
4. ✅ 灵魂水晶显示数量和用途
5. ✅ 金币显示数量和用途
6. ✅ 装备和消耗品正常显示tooltip

## 数据完整性检查

### 装备数据库检查结果

所有装备都有完整的`descZh`字段：

| 装备类型 | T1 | T2 | T3 | 描述完整性 |
|---------|----|----|----|---------:|
| 铁剑 | ✅ | ✅ | ✅ | 100% |
| 黄金剑 | ✅ | ✅ | ✅ | 100% |
| 法杖 | ✅ | ✅ | ✅ | 100% |
| 镰刀 | ✅ | ✅ | ✅ | 100% |
| 皮甲 | ✅ | ✅ | ✅ | 100% |
| 锁子甲 | ✅ | ✅ | ✅ | 100% |
| 板甲 | ✅ | ✅ | ✅ | 100% |
| 法袍 | ✅ | ✅ | ✅ | 100% |
| 铁盔 | ✅ | ✅ | ✅ | 100% |
| 皇冠 | ✅ | ✅ | ✅ | 100% |
| 布鞋 | ✅ | ✅ | ✅ | 100% |
| 铁靴 | ✅ | ✅ | ✅ | 100% |
| 手镯 | ✅ | ✅ | ✅ | 100% |
| 戒指 | ✅ | ✅ | ✅ | 100% |
| 护符 | ✅ | ✅ | ✅ | 100% |
| 吊坠 | ✅ | ✅ | ✅ | 100% |

### 消耗品数据库检查结果

| 消耗品 | descZh | 完整性 |
|-------|--------|--------|
| 小型药水 | ✅ | 100% |
| 怒气药水 | ✅ | 100% |
| 知识卷轴 | ✅ | 100% |
| 火焰卷轴 | ✅ | 100% |
| 钻头 | ✅ | 100% |
| 保护卷轴 | ✅ | 100% |
| 祝福石 | ✅ | 100% |

**结论**：所有装备和消耗品的描述数据都是完整的，问题出在TooltipManager未处理某些特殊类型。

## 描述示例

### 法杖描述（已存在）

**木制法杖 (T1)**
```
一根普通的橡木手杖，能够微弱地引导魔法能量。
```

**法师法杖 (T2)**
```
镶嵌着低阶魔晶的法杖，是正式法师的标准装备。
```

**大法师之杖 (T3)**
```
大法师生前使用的法杖，蕴含着狂暴的奥术能量。
```

### Buff描述（已存在）

| Buff | 描述 |
|------|------|
| Might | 物攻提升 |
| Iron Skin | 物防提升 |
| Arcana | 魔攻提升 |
| Ward | 魔防提升 |
| Vitality | 提升最大生命并回复 |
| Fury | 获得怒气 |
| Fortune | 获得金币 |

## 兼容性

- ✅ 向后兼容：不影响现有tooltip显示
- ✅ 扩展性：可以轻松添加更多物品类型
- ✅ 性能：不增加额外的性能开销
- ✅ 一致性：所有物品类型使用统一的tooltip样式

## 注意事项

1. **物品对象结构**：确保物品对象包含必要的字段（`type`、`name`、`data`等）
2. **Buff数据**：Buff必须包含`data`字段（指向BUFF_POOL中的buff定义）
3. **数量显示**：灵魂水晶和金币的`value`字段用于显示数量
4. **标签翻译**：Buff标签会自动翻译为中文

## 后续优化建议

1. **Buff描述增强**：可以为Buff添加更详细的描述文本
2. **数值显示**：可以在Buff tooltip中显示具体的数值加成
3. **持续时间**：如果Buff有持续时间，可以在tooltip中显示
4. **图标优化**：可以为不同类型的物品使用更精美的图标
