# 幸运石品质系统更新

## 更新日期
2026-01-18

## 更新内容

### 1. 修正成功率加成数值
- **修正前**：普通幸运石提升0.05（即5%）的强化成功率
- **修正后**：普通幸运石提升0.05%的强化成功率
- **原因**：原数值过高，不符合"安慰奖"的设计定位

### 2. 新增多品质幸运石系统

现在幸运石有5个品质等级，每个品质提供不同的成功率加成：

| 品质 | 名称 | 成功率加成 | 价值 | 出现概率 |
|------|------|-----------|------|---------|
| 普通 (COMMON) | 幸运石 | +0.05% | 1 | 50% (普通品质时) |
| 优秀 (UNCOMMON) | 优质幸运石 | +0.2% | 2 | 30% (优秀品质时) |
| 稀有 (RARE) | 稀有幸运石 | +0.5% | 5 | 20% (稀有品质时) |
| 史诗 (EPIC) | 史诗幸运石 | +0.8% | 10 | 15% (史诗品质时) |
| 传说 (LEGENDARY) | 传说幸运石 | +1% | 20 | 10% (传说品质时) |

### 3. 幸运石详细信息

#### 普通幸运石 (COMMON)
```
名称：幸运石
图标：🪨
成功率加成：+0.05%
描述：普通的幸运石，可作为强化底料使用，提升0.05%的强化成功率。
      虽然效果微弱，但总比一无所获要好。
```

#### 优质幸运石 (UNCOMMON)
```
名称：优质幸运石
图标：🪨
成功率加成：+0.2%
描述：优质的幸运石，蕴含更多的幸运之力，可作为强化底料使用，
      提升0.2%的强化成功率。
```

#### 稀有幸运石 (RARE)
```
名称：稀有幸运石
图标：🪨
成功率加成：+0.5%
描述：稀有的幸运石，散发着淡淡的光芒，可作为强化底料使用，
      提升0.5%的强化成功率。
```

#### 史诗幸运石 (EPIC)
```
名称：史诗幸运石
图标：🪨
成功率加成：+0.8%
描述：史诗级的幸运石，闪耀着迷人的光辉，可作为强化底料使用，
      提升0.8%的强化成功率。
```

#### 传说幸运石 (LEGENDARY)
```
名称：传说幸运石
图标：🪨
成功率加成：+1%
描述：传说中的幸运石，蕴含着命运女神的祝福，可作为强化底料使用，
      提升1%的强化成功率。
```

## 技术实现

### 1. 生成逻辑（src/ui/GamblerUI.js）

```javascript
// 根据品质和概率生成幸运石
const shouldGenerateLuckyStone = (
  (quality === 'COMMON' && Math.random() < 0.5) ||
  (quality === 'UNCOMMON' && Math.random() < 0.3) ||
  (quality === 'RARE' && Math.random() < 0.2) ||
  (quality === 'EPIC' && Math.random() < 0.15) ||
  (quality === 'LEGENDARY' && Math.random() < 0.1)
);
```

### 2. 数据结构

```javascript
{
  type: 'trash',
  name: '幸运石',
  quality: 'COMMON',
  icon: '🪨',
  desc: '...',
  successRateBonus: 0.0005  // 0.05%
}
```

### 3. Tooltip显示（src/utils/TooltipManager.js）

- 自动识别所有包含"幸运石"的物品
- 显示类型为"强化材料"
- 成功率加成以百分比形式显示（保留2位小数）
- 示例：`强化成功率: +0.05%`

## 设计理念

### 成功率加成梯度设计

1. **普通（0.05%）**：真正的安慰奖，效果极其微弱
2. **优秀（0.2%）**：4倍于普通，开始有一点实用价值
3. **稀有（0.5%）**：10倍于普通，有明显的帮助
4. **史诗（0.8%）**：16倍于普通，相当实用
5. **传说（1%）**：20倍于普通，最高加成

### 出现概率设计

- 高品质幸运石的出现概率较低
- 确保高品质幸运石的稀有性
- 平衡游戏经济和玩家体验

### 价值设定

- 价值随品质递增
- 反映物品的稀有度和实用性
- 可用于后续的交易或兑换系统

## 游戏平衡性

### 强化成功率影响

假设基础成功率为50%：

| 幸运石品质 | 加成 | 最终成功率 | 提升幅度 |
|-----------|------|-----------|---------|
| 无 | 0% | 50.00% | - |
| 普通 | +0.05% | 50.05% | +0.1% |
| 优秀 | +0.2% | 50.20% | +0.4% |
| 稀有 | +0.5% | 50.50% | +1% |
| 史诗 | +0.8% | 50.80% | +1.6% |
| 传说 | +1% | 51.00% | +2% |

### 多个幸运石叠加

如果允许使用多个幸运石：
- 5个普通幸运石 = +0.25%（相当于1个优秀+）
- 5个传说幸运石 = +5%（显著提升）

## 兼容性

- ✅ 向后兼容：不影响现有系统
- ✅ 扩展性：可以轻松添加更多品质
- ✅ 平衡性：数值经过精心设计

## 修改的文件

1. **src/ui/GamblerUI.js**
   - 更新`generateItemByQuality`方法
   - 添加多品质幸运石生成逻辑
   - 修正成功率加成数值

2. **src/utils/TooltipManager.js**
   - 更新幸运石tooltip生成逻辑
   - 支持所有品质的幸运石
   - 修正百分比显示格式

3. **test_gambler_tooltip.html**
   - 添加所有品质幸运石的测试用例

4. **test_gambler_rewards.html**
   - 更新生成逻辑以匹配新系统

## 测试验证

### 测试页面
```bash
# 在浏览器中打开
test_gambler_tooltip.html
test_gambler_rewards.html
```

### 测试内容
1. ✅ 所有品质的幸运石都能正确生成
2. ✅ Tooltip显示正确的成功率加成（百分比格式）
3. ✅ 描述文本根据品质不同
4. ✅ 品质颜色正确显示

## 后续工作

### 铁匠铺集成（待实现）
- 在强化界面中添加幸运石选择功能
- 实现幸运石的消耗逻辑
- 显示使用幸运石后的成功率预览

### 背包系统集成（待实现）
- 幸运石在背包中的显示
- 幸运石的堆叠逻辑
- 幸运石的使用和丢弃

### 交易系统（可选）
- 幸运石的交易价格
- 幸运石的兑换比例
- 幸运石的商店售价

## 注意事项

1. **数值平衡**：当前数值经过设计，但可能需要根据实际游戏数据调整
2. **堆叠限制**：建议设置幸运石的最大堆叠数量（如99个）
3. **使用限制**：建议每次强化只能使用1个幸运石，避免过度叠加
4. **获取途径**：目前只能从赌徒处获得，后续可以添加其他获取方式

## 数值调整建议

如果发现数值不平衡，可以考虑以下调整方案：

### 方案A：线性增长
- 普通：0.05%
- 优秀：0.1%
- 稀有：0.2%
- 史诗：0.5%
- 传说：1%

### 方案B：指数增长
- 普通：0.05%
- 优秀：0.15%
- 稀有：0.4%
- 史诗：0.7%
- 传说：1%

### 方案C：保守增长（当前方案）
- 普通：0.05%
- 优秀：0.2%
- 稀有：0.5%
- 史诗：0.8%
- 传说：1%
