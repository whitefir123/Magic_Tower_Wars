# 十连抽优化方案

## ✅ 优化内容

### 1. 进度提示系统

#### 动态进度显示
在十连抽过程中，NPC 文本会实时显示进度：
```
正在抽取... (1/10)
正在抽取... (2/10)
正在抽取... (3/10)
...
正在抽取... (10/10)
```

#### 实现方式
```javascript
for (let i = 0; i < batchCount; i++) {
  // 更新进度提示
  if (this.gamblerNPC && this.gamblerNPC.messageElement) {
    this.gamblerNPC.messageElement.textContent = `正在抽取... (${i + 1}/10)`;
  }
  
  // 抽取逻辑...
  
  // 短暂延迟，让玩家感受到抽取过程
  await this.sleep(100);
}
```

### 2. NPC 对话系统集成

#### 使用统一的评判语系统
不再使用硬编码的消息，而是使用 `showJudgement()` 方法：

```javascript
// 构建虚拟上下文
const context = {
  result: { quality: quality, type: 'batch' },
  pityCount: this.player?.stats?.gamblerPityCount || 0,
  isNearMiss: false,
  playerGold: this.player?.stats?.gold || 0
};

// 使用统一的评判语系统
this.gamblerNPC.showJudgement(context);
```

#### 优势
- ✅ 评判语更加丰富多样
- ✅ 时间统一为 5秒
- ✅ 自动启动催促系统
- ✅ 与单抽体验一致

### 3. 抽取节奏优化

#### 添加微小延迟
每次抽取后添加 100ms 延迟：
```javascript
await this.sleep(100);
```

#### 效果
- ✅ 让玩家感受到抽取过程
- ✅ 进度提示更新更流畅
- ✅ 不会太慢影响体验
- ✅ 总耗时约 1秒（10次 × 100ms）

## 📊 优化对比

### 优化前
```
点击十连抽
    ↓
显示等待语（静态）
    ↓
快速完成所有抽取
    ↓
弹出 alert 汇总
    ↓
显示固定的 NPC 消息（3秒）
    ↓
开始催促
```

### 优化后
```
点击十连抽
    ↓
显示等待语
    ↓
动态显示进度 (1/10 → 10/10)
    ↓
每次抽取间隔 100ms
    ↓
弹出 alert 汇总
    ↓
显示智能评判语（5秒）
    ↓
自动开始催促
```

## 🎮 用户体验提升

### 1. 视觉反馈
- ✅ 实时进度显示
- ✅ 动态文本更新
- ✅ 清晰的抽取过程

### 2. 时间感知
- ✅ 100ms 延迟让过程可感知
- ✅ 不会太快显得廉价
- ✅ 不会太慢影响体验

### 3. 对话一致性
- ✅ 评判语与单抽一致
- ✅ 时间设置统一（5秒）
- ✅ 催促系统自动启动

### 4. 智能评判
根据十连抽结果智能选择评判语：
- **有传说/大奖** → 传说级评判语
- **有史诗** → 史诗级评判语
- **有稀有** → 稀有级评判语
- **其他** → 普通评判语

## 💡 进一步优化建议

### 1. 替换 alert 弹窗
可以考虑使用自定义的模态框替代 alert：
```javascript
// 创建美观的结果展示界面
showBatchResultModal(results) {
  // 显示卡片式结果
  // 带动画效果
  // 可以点击关闭
}
```

### 2. 添加音效
在抽取过程中添加音效反馈：
```javascript
// 每次抽取时
game.audio.playBookFlip();

// 抽到好东西时
if (reward.quality === 'LEGENDARY') {
  game.audio.playSpecialSound();
}
```

### 3. 视觉特效
在抽到高品质物品时添加特效：
```javascript
if (['EPIC', 'LEGENDARY'].includes(reward.quality)) {
  // 显示闪光特效
  this.particleSystem.burst(x, y, reward.quality);
}
```

### 4. 进度条
用进度条替代文本进度：
```javascript
// 显示进度条
<div class="batch-progress">
  <div class="progress-bar" style="width: ${(i+1)/10*100}%"></div>
  <span>${i+1}/10</span>
</div>
```

## 🎯 当前实现效果

### 完整流程
```
00:00 - 点击十连抽
00:00 - 停止催促
00:00 - "正在抽取... (1/10)"
00:10 - "正在抽取... (2/10)"
00:20 - "正在抽取... (3/10)"
...
01:00 - "正在抽取... (10/10)"
01:00 - 显示汇总弹窗
01:00 - 关闭弹窗后显示评判语
06:00 - 开始催促
```

### 特殊情况
如果抽到史诗/传说：
```
00:00 - 点击十连抽
00:00 - "正在抽取... (1/10)"
00:10 - "正在抽取... (2/10)"
00:20 - "正在抽取... (3/10)"
00:30 - 抽到史诗！
00:30 - 显示动画
01:30 - 继续 "正在抽取... (4/10)"
...
```

## ✨ 优化亮点

1. **进度可视化** - 玩家清楚知道抽取进度
2. **节奏控制** - 100ms 延迟让过程更有仪式感
3. **系统统一** - 使用相同的评判语和催促系统
4. **智能反馈** - 根据结果选择合适的评判语
5. **体验流畅** - 从开始到结束一气呵成

## 📝 总结

通过这些优化，十连抽的体验得到了显著提升：
- ✅ 进度清晰可见
- ✅ 对话系统统一
- ✅ 时间设置一致
- ✅ 催促自动启动
- ✅ 用户体验流畅

十连抽现在与单抽一样完美！
