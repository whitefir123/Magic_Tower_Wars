我将分三步实现“背后”概念和相关机制：

### 1. 核心数据结构升级 (src/entities.js)

* **Entity 类**:

  * 新增 `direction` 属性（0:下, 1:上, 2:左, 3:右），作为逻辑判定的核心依据。

  * 新增 `setDirection(dir)` 方法，统一管理逻辑方向和视觉朝向（Sprite）。

* **Player & Monster 类**:

  * 重构移动和攻击逻辑，将所有直接操作 `sprite.setDirection` 的代码替换为 `this.setDirection`，确保数据层与表现层同步。

  * **Monster AI 优化**: 怪物在移动或攻击时会显式更新朝向，使玩家可以通过观察怪物贴图判断其关注方向。

### 2. 战斗系统增强 (src/systems/CombatSystem.js)

* **新增判定函数**: `static isBackAttack(attacker, defender)`

  * 基于 `defender.direction` 和双方位置坐标，精准判断攻击是否来自背后。

  * 判定规则：

    * 目标朝下(0) -> 攻击者在上方(y-1)

    * 目标朝上(1) -> 攻击者在下方(y+1)

    * 目标朝左(2) -> 攻击者在右方(x+1)

    * 目标朝右(3) -> 攻击者在左方(x-1)

* **盗贼技能重构 (Backstab)**:

  * 修改 `backstab` 技能逻辑：不再是无条件 200% 伤害。

  * **机制**:

    * **背后发动**: 造成 **200%** 伤害，必定暴击，显示特有飘字“背刺!”。

    * **正面/侧面发动**: 仅造成 **120%** 伤害（惩罚），不触发必爆。

* **通用背击奖励 (全局机制)**:

  * 即使不使用技能，任何从背后发动的攻击（玩家打怪或怪打玩家）都获得 **+15% 伤害加成**。

  * 这将鼓励玩家走位，也让被怪物包围更加危险。

### 3. 视觉与反馈优化

* 添加战斗飘字反馈：触发背击时显示“背刺!”或特殊颜色的伤害数字。

### 计划执行步骤

1. 修改 `src/entities.js`，添加 `direction` 属性和 `setDirection` 方法，更新所有相关调用。
2. 修改 `src/systems/CombatSystem.js`，实现 `isBackAttack` 和战斗逻辑修改。
3. 验证修改，确保盗贼技能和普通攻击都能正确识别方向。

