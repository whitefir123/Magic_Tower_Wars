# 赌徒奖励系统更新说明

## 更新日期
2026-01-18

## 更新内容

### 1. 移除奖品
- ❌ **保护卷轴** (ITEM_PROTECTION_SCROLL) - 已从消耗品池中移除
- ❌ **祝福石** (ITEM_BLESSING_STONE) - 已从消耗品池中移除

这两个物品现在只能通过其他途径获得（如铁匠铺任务、宝箱等），不再出现在赌徒的奖品池中。

### 2. 新增奖品类型：符文
- ✅ **符文** (RUNE) - 新增10%概率获得符文
- 符文只在**优秀品质及以上**出现（UNCOMMON+）
- 只提供**STAT类型**的符文（基础属性提升）
- 符文品质映射：
  - UNCOMMON → COMMON符文
  - RARE → RARE符文
  - EPIC → RARE符文
  - LEGENDARY → LEGENDARY符文

### 3. 幸运石描述优化
幸运石现在包含详细的物品描述：

**普通幸运石 (COMMON)**
- 名称：幸运石
- 图标：🪨（保持不变）
- 描述：*"普通的幸运石，可作为强化底料使用，提升0.05的强化成功率。虽然效果微弱，但总比一无所获要好。"*
- 强化成功率加成：+0.05 (5%)
- 作用：作为铁匠铺强化武器的可选底料，提供微弱的成功率加成

### 4. 符文描述系统
符文根据品质提供不同的描述前缀：

- **传说级符文**：*"传说级符文，蕴含强大的力量。[符文效果]"*
- **史诗级符文**：*"史诗级符文，效果显著。[符文效果]"*
- **稀有符文**：*"稀有符文，具有不错的效果。[符文效果]"*
- **普通符文**：*"普通符文，提供基础属性加成。[符文效果]"*

### 5. 奖励权重调整

**更新前：**
```javascript
REWARD_WEIGHTS: {
  EQUIPMENT: 65,      // 65% 装备
  CONSUMABLE: 25,     // 25% 消耗品
  BUFF: 8,            // 8% 临时 Buff
  SOUL_CRYSTAL: 2     // 2% 灵魂水晶
}
```

**更新后：**
```javascript
REWARD_WEIGHTS: {
  EQUIPMENT: 60,      // 60% 装备 (-5%)
  CONSUMABLE: 20,     // 20% 消耗品 (-5%)
  RUNE: 10,           // 10% 符文 (新增)
  BUFF: 8,            // 8% 临时 Buff
  SOUL_CRYSTAL: 2     // 2% 灵魂水晶
}
```

## 技术实现

### 修改的文件

1. **src/data/items.js**
   - 从 `CONSUMABLE_IDS` 数组中移除保护卷轴和祝福石

2. **src/data/system.js**
   - 更新 `GAMBLER_CONFIG.REWARD_WEIGHTS` 添加符文类型

3. **src/ui/GamblerUI.js**
   - 导入 `RUNE_POOL` 符文池
   - 更新 `generateItemByQuality()` 函数：
     - 添加幸运石描述数据
     - 添加符文生成逻辑
     - 添加品质限制（符文不在COMMON品质出现）
   - 更新奖励发放逻辑，添加符文处理分支

### 符文发放逻辑
```javascript
case 'rune':
  if (reward.runeId && game.roguelikeSystem) {
    game.roguelikeSystem.addRune(reward.runeId);
    if (game.ui && game.ui.logMessage) {
      game.ui.logMessage(`获得符文: ${reward.name}`, 'gain');
    }
  }
  break;
```

## 设计理念

### 幸运石的定位
- **安慰奖**：作为最低品质的奖品，给予玩家一定的心理安慰
- **微弱效果**：0.05的成功率加成确实很小，但聊胜于无
- **可选使用**：在铁匠铺强化时可加可不加，不强制使用
- **不是主要作用**：强调这只是安慰品，不是强化的核心机制

### 符文的定位
- **中等价值奖励**：10%概率，介于装备和灵魂水晶之间
- **品质门槛**：只在优秀品质及以上出现，保持稀有性
- **属性提升**：只提供STAT类符文，确保实用性
- **即时生效**：获得后立即添加到玩家的符文系统

## 测试

运行测试页面：
```bash
# 在浏览器中打开
test_gambler_rewards.html
```

测试功能：
- 标准旋转测试
- 豪赌旋转测试
- 批量生成100次统计
- 实时查看各类型奖品的分布

## 兼容性

- ✅ 向后兼容：已有的保护卷轴和祝福石不会消失
- ✅ 存档兼容：不影响现有存档数据
- ✅ 系统集成：符文系统已存在，无需额外初始化

## 注意事项

1. 保护卷轴和祝福石仍然存在于游戏中，只是不再从赌徒处获得
2. 幸运石的强化底料功能需要在铁匠铺系统中实现（如果尚未实现）
3. 符文获得会触发 `roguelikeSystem.addRune()` 方法
4. 所有描述文本都是中文，符合游戏本地化需求
