# 需求文档：赌徒界面全面优化

## 简介

本文档规定了赌徒（老虎机）界面的优化需求，包括 CSGO2 风格的抽奖动画和增强的视觉/机制特性。系统将把现有的基础横向滚动动画转变为高级赌博体验，具有渐进减速、基于品质的视觉效果、粒子系统和增强的玩家参与机制。

## 术语表

- **赌徒系统 (Gambler_System)**: 允许玩家花费金币获得随机奖励的老虎机赌博界面
- **滚轮条 (Reel_Strip)**: 在旋转动画期间显示物品卡片的横向滚动显示区域
- **品质等级 (Quality_Tier)**: 奖励的稀有度等级（普通、优秀、稀有、史诗、传说、大奖）
- **保底系统 (Pity_System)**: 现有机制，在连续获得普通结果后增加稀有物品概率
- **大奖池 (Jackpot_Pool)**: 从所有旋转中累积的金币，可通过大奖触发赢得
- **旋转动画 (Spin_Animation)**: 显示物品横向滚动直到停在最终结果的视觉效果
- **粒子系统 (Particle_System)**: 用于渲染漂浮粒子、爆炸和环境效果的视觉效果系统
- **快速跳过 (Quick_Skip)**: 允许玩家在动画期间点击立即显示结果的功能
- **批量抽取 (Batch_Pull)**: 允许以折扣价进行多次连续旋转的 10 连抽系统
- **赌徒 NPC (Gambler_NPC)**: 在赌博互动期间提供上下文对话的角色实体
- **结果显示 (Result_Display)**: 旋转完成后显示最终奖励的 UI 组件
- **历史显示 (History_Display)**: 显示最近 5 次旋转结果的 UI 组件
- **老虎机背景 (Slot_Machine_Background)**: 包含滚轮显示区域的华丽视觉框架

## 需求

### 需求 1：老虎机视觉集成

**用户故事：** 作为玩家，我希望在赌博界面周围看到华丽的老虎机框架，以便体验感觉更加沉浸和高级。

#### 验收标准

1. 当赌徒系统打开时，系统应显示来自 https://i.postimg.cc/XYVXxV9N/dutuji.png 的老虎机背景图像
2. 系统应将滚轮条定位在老虎机背景的指定显示区域内
3. 系统应应用深度效果，包括阴影和分层，以创建视觉层次
4. 老虎机背景应在不同屏幕尺寸下保持适当的纵横比和缩放

### 需求 2：渐进减速动画

**用户故事：** 作为玩家，我希望滚轮动画感觉戏剧性和悬疑，以便每次旋转都令人兴奋和引人入胜。

#### 验收标准

1. 当旋转动画开始时，系统应在 0.3 秒内将滚轮条加速到最大速度
2. 当滚轮条旋转时，系统应保持恒定的高速 2 秒
3. 当进入最后 1.5 秒时，系统应使用三次贝塞尔缓动曲线应用渐进减速
4. 当进入最后 0.5 秒时，系统应应用戏剧性的顿挫效果，具有 3-5 个可见的减速步骤
5. 当滚轮条处于高速时，系统应对物品卡片应用运动模糊效果

### 需求 3：品质预告系统

**用户故事：** 作为玩家，我希望在稀有物品即将出现时获得视觉提示，以便在旋转期间感受到期待和兴奋的积累。

#### 验收标准

1. 当旋转结果为稀有或更高品质时，系统应在最后 2 秒内将滚轮条背景更改为与品质相适应的渐变颜色
2. 当旋转结果为史诗或传说时，系统应在最后 1.5 秒内向屏幕边缘添加发光效果
3. 当品质预告效果激活时，系统应播放营造紧张感的音效
4. 系统不应在预告期间透露确切物品，只提示品质等级

### 需求 4：结果显示效果

**用户故事：** 作为玩家，我希望根据我赢得的东西有不同的视觉庆祝效果，以便稀有奖励感觉特别和令人难忘。

#### 验收标准

1. 当显示普通或优秀结果时，系统应显示简单的淡入动画
2. 当显示稀有结果时，系统应显示持续 1 秒的蓝色脉冲发光效果
3. 当显示史诗结果时，系统应显示从中心辐射的紫色爆炸粒子
4. 当显示传说结果时，系统应显示橙色屏幕闪光，然后是闪光粒子
5. 当显示大奖结果时，系统应显示全屏金币雨、屏幕震动效果和最终停止的慢动作回放

### 需求 5：粒子效果系统

**用户故事：** 作为玩家，我希望在老虎机周围看到魔法粒子效果，以便界面感觉生动和充满魔力。

#### 验收标准

1. 当赌徒系统打开时，粒子系统应在老虎机背景周围渲染漂浮的魔法尘埃粒子
2. 当显示稀有或更高结果时，粒子系统应渲染与品质相适应的爆炸效果
3. 当赢得大奖时，粒子系统应渲染具有基于物理的下落运动的金币雨动画
4. 粒子系统应在最多 100 个活动粒子的情况下保持 60fps 性能
5. 粒子系统应使用对象池来最小化内存分配

### 需求 6：快速跳过功能

**用户故事：** 作为玩家，我希望在赶时间时跳过动画，以便我可以快速赌博而无需等待。

#### 验收标准

1. 当旋转动画激活时，系统应显示"点击跳过"提示覆盖层
2. 当玩家在旋转动画期间点击任何地方时，系统应立即停止动画并显示结果
3. 当触发快速跳过时，系统应播放最多持续 0.5 秒的结果效果缩略版本
4. 系统不应在自然动画的最后 0.3 秒内允许快速跳过，以保持戏剧性时机

### 需求 7：历史显示

**用户故事：** 作为玩家，我希望看到我最近的旋转结果，以便我可以追踪我的运气并感受差一点的心理影响。

#### 验收标准

1. 系统应在界面底部的历史显示中显示最近 5 次旋转结果
2. 当新旋转完成时，系统应将结果添加到历史显示并删除最旧的条目
3. 历史显示应显示每个结果具有与品质相适应的彩色边框的迷你卡片
4. 历史显示应显示每个历史结果的物品图标和品质指示器

### 需求 8：批量抽取系统

**用户故事：** 作为玩家，我希望一次进行 10 次旋转并享受折扣，以便我可以更高效地赌博并获得更好的价值。

#### 验收标准

1. 系统应提供一个"10连抽"按钮，花费 450 金币而不是 500 金币
2. 当玩家激活批量抽取时，系统应从玩家扣除 450 金币
3. 当执行批量抽取时，系统应以快进动画模式执行 10 次连续旋转
4. 当批量抽取完成时，系统应显示一个摘要屏幕，显示所有 10 个结果及其品质等级
5. 当批量抽取中的任何结果为史诗或更高时，系统应在该结果上短暂暂停并显示适当的效果

### 需求 9：动态赔率显示

**用户故事：** 作为玩家，我希望看到我当前的机会和保底进度，以便我了解系统并对我的赔率有所了解。

#### 验收标准

1. 系统应显示一个保底进度条，显示当前的保底系统计数
2. 系统应显示每个品质等级的当前概率百分比
3. 当保底系统计数增加时，系统应实时更新显示的概率
4. 系统应通过视觉指示器显示保底如何影响赔率（例如，"稀有几率 +5%"）

### 需求 10：赌徒 NPC 角色

**用户故事：** 作为玩家，我希望有一个神秘的赌徒角色对我的旋转发表评论，以便体验感觉更加个人化和有趣。

#### 验收标准

1. 系统应在界面中显示赌徒 NPC 肖像或精灵
2. 当旋转结果在传说物品的 2 个位置内时，赌徒 NPC 应说"哎呀，差一点！"
3. 当赢得传说或大奖时，赌徒 NPC 应说"天选之人！"
4. 当保底系统计数为 7 或更高时，赌徒 NPC 应说"运气正在积聚..."
5. 赌徒 NPC 应在带有淡入/淡出动画的对话气泡中显示对话

### 需求 11：成就集成

**用户故事：** 作为玩家，我希望通过赌博获得成就，以便我有额外的目标和对我的赌博活动的认可。

#### 验收标准

1. 当玩家连续赢得 3 个史诗或更高结果时，系统应授予"欧皇"成就
2. 当玩家总共触发保底系统 10 次时，系统应授予"非酋"成就
3. 当玩家从豪赌旋转中赢得传说时，系统应授予"梭哈王"成就
4. 当玩家在剩余金币少于 100 时赌博，系统应授予"破产边缘"成就

### 需求 12：音效设计系统

**用户故事：** 作为玩家，我希望在赌博期间获得丰富的音频反馈，以便体验更加沉浸和令人满意。

#### 验收标准

1. 当旋转动画激活时，系统应播放机械齿轮循环声音
2. 当滚轮条减速时，系统应播放咔哒声，节奏递减以匹配视觉减速
3. 当滚轮条停止时，系统应播放与品质相适应的"叮"声，音调根据品质等级变化
4. 当赢得大奖时，系统应播放人群欢呼声，然后是金币级联音频
5. 当赌徒系统打开时，系统应以低音量播放微妙的赌场氛围背景音频

### 需求 13：性能优化

**用户故事：** 作为玩家，我希望赌博界面运行流畅，以便动画流畅且响应迅速。

#### 验收标准

1. 系统应对所有滚轮条动画使用带有 GPU 加速的 CSS 变换
2. 粒子系统应实现对象池以重用粒子实例
3. 系统应仅在赌徒系统打开时延迟加载动画资源
4. 系统应在包括粒子效果在内的所有动画期间保持 60fps
5. 当赌徒系统关闭时，系统应释放未使用的资源以释放内存

### 需求 14：移动端适配

**用户故事：** 作为移动端玩家，我希望赌博界面在我的设备上运行良好，以便我可以享受与桌面玩家相同的体验。

#### 验收标准

1. 系统应确保所有交互按钮的触摸目标至少为 44x44 像素
2. 当玩家在动画期间在滚轮条上滑动时，系统应触发快速跳过
3. 系统应使用响应式布局，适应从 320px 到 1920px 的屏幕宽度
4. 系统应在小屏幕上按比例缩放老虎机背景，同时保持可读性

### Requirement 15: Accessibility Features

**User Story:** As a player with accessibility needs, I want options to reduce motion and get alternative feedback, so that I can use the gambling system comfortably.

#### Acceptance Criteria

1. WHEN reduced motion mode is enabled, THE System SHALL skip all Spin_Animation and show results immediately
2. WHEN reduced motion mode is enabled, THE System SHALL replace particle effects with simple color flashes
3. THE System SHALL announce spin results to screen readers with format "[Quality] [Item Name] obtained"
4. THE System SHALL support keyboard navigation for all buttons using Tab and Enter keys
5. THE System SHALL provide focus indicators on all interactive elements
